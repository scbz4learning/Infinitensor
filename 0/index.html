
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://scbz4learning.github.io/Infinitensor/0/">
      
      
        <link rel="prev" href="..">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>Stage 0 - Scbz's blog of learning Infinitensor 2025 Summer</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#stage-0" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://scbz4learning.github.io/Infinitensor" title="Scbz&#39;s blog of learning Infinitensor 2025 Summer" class="md-header__button md-logo" aria-label="Scbz's blog of learning Infinitensor 2025 Summer" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Scbz's blog of learning Infinitensor 2025 Summer
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Stage 0
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/scbz4learning/Infinitensor" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://scbz4learning.github.io/Infinitensor" title="Scbz&#39;s blog of learning Infinitensor 2025 Summer" class="md-nav__button md-logo" aria-label="Scbz's blog of learning Infinitensor 2025 Summer" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Scbz's blog of learning Infinitensor 2025 Summer
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/scbz4learning/Infinitensor" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Scbz's blog of learning Infinitensor 2025 Summer
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Stage 0
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Stage 0
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#day-01-rustlings-00-10" class="md-nav__link">
    <span class="md-ellipsis">
      Day 01 - rustlings 00-10
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Day 01 - rustlings 00-10">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    <span class="md-ellipsis">
      Variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#move-semantics" class="md-nav__link">
    <span class="md-ellipsis">
      Move Semantics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structs" class="md-nav__link">
    <span class="md-ellipsis">
      Structs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#string-and-str" class="md-nav__link">
    <span class="md-ellipsis">
      String and &amp;str
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vec" class="md-nav__link">
    <span class="md-ellipsis">
      Vec
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modules" class="md-nav__link">
    <span class="md-ellipsis">
      Modules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#day-02-rustlings-11-13" class="md-nav__link">
    <span class="md-ellipsis">
      Day 02 - rustlings 11-13
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Day 02 - rustlings 11-13">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hashmaps" class="md-nav__link">
    <span class="md-ellipsis">
      Hashmaps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#options" class="md-nav__link">
    <span class="md-ellipsis">
      Options
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handling-results" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling (Results)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Handling (Results)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#errors4rs" class="md-nav__link">
    <span class="md-ellipsis">
      errors4.rs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#errors6rs" class="md-nav__link">
    <span class="md-ellipsis">
      errors6.rs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="errors6.rs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#now-how-can-we-handle-errors" class="md-nav__link">
    <span class="md-ellipsis">
      Now how can we handle errors?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creationerror-internal" class="md-nav__link">
    <span class="md-ellipsis">
      CreationError internal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fix-to-do" class="md-nav__link">
    <span class="md-ellipsis">
      Fix to do
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-standarised-way-from-trait" class="md-nav__link">
    <span class="md-ellipsis">
      A Standarised Way - From Trait
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#map_err-internal" class="md-nav__link">
    <span class="md-ellipsis">
      map_err Internal
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#day-01-rustlings-00-10" class="md-nav__link">
    <span class="md-ellipsis">
      Day 01 - rustlings 00-10
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Day 01 - rustlings 00-10">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    <span class="md-ellipsis">
      Variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#move-semantics" class="md-nav__link">
    <span class="md-ellipsis">
      Move Semantics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structs" class="md-nav__link">
    <span class="md-ellipsis">
      Structs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#string-and-str" class="md-nav__link">
    <span class="md-ellipsis">
      String and &amp;str
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vec" class="md-nav__link">
    <span class="md-ellipsis">
      Vec
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modules" class="md-nav__link">
    <span class="md-ellipsis">
      Modules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#day-02-rustlings-11-13" class="md-nav__link">
    <span class="md-ellipsis">
      Day 02 - rustlings 11-13
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Day 02 - rustlings 11-13">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hashmaps" class="md-nav__link">
    <span class="md-ellipsis">
      Hashmaps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#options" class="md-nav__link">
    <span class="md-ellipsis">
      Options
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handling-results" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling (Results)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Handling (Results)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#errors4rs" class="md-nav__link">
    <span class="md-ellipsis">
      errors4.rs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#errors6rs" class="md-nav__link">
    <span class="md-ellipsis">
      errors6.rs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="errors6.rs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#now-how-can-we-handle-errors" class="md-nav__link">
    <span class="md-ellipsis">
      Now how can we handle errors?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creationerror-internal" class="md-nav__link">
    <span class="md-ellipsis">
      CreationError internal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fix-to-do" class="md-nav__link">
    <span class="md-ellipsis">
      Fix to do
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-standarised-way-from-trait" class="md-nav__link">
    <span class="md-ellipsis">
      A Standarised Way - From Trait
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#map_err-internal" class="md-nav__link">
    <span class="md-ellipsis">
      map_err Internal
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="stage-0">Stage 0<a class="headerlink" href="#stage-0" title="Permanent link">&para;</a></h1>
<h2 id="day-01-rustlings-00-10">Day 01 - rustlings 00-10<a class="headerlink" href="#day-01-rustlings-00-10" title="Permanent link">&para;</a></h2>
<p>Selected questions</p>
<h3 id="variables">Variables<a class="headerlink" href="#variables" title="Permanent link">&para;</a></h3>
<ol>
<li>must use <code>let</code>, type can be inferred automatically, except <code>const</code>.  </li>
<li><code>const</code> must be named with a type.  </li>
<li>Only var with <code>mut</code> can be mutable.  </li>
<li>vars can be <strong>shadowing</strong> with a new type/ value.   </li>
</ol>
<h3 id="move-semantics">Move Semantics<a class="headerlink" href="#move-semantics" title="Permanent link">&para;</a></h3>
<p>Just remind:<br />
1. One variable one ownership<br />
2. Variable can be borrowed, but there is at most 1 <strong>mutable borrow</strong> simultaneously   </p>
<h3 id="structs">Structs<a class="headerlink" href="#structs" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> why we need "UnitStructs"?  </li>
</ul>
<h3 id="string-and-str"><code>String</code> and <code>&amp;str</code><a class="headerlink" href="#string-and-str" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> The methods are weird... Some methods can change the type while somes are not...</li>
</ul>
<h3 id="vec">Vec<a class="headerlink" href="#vec" title="Permanent link">&para;</a></h3>
<p><code>input.iter().map(|element| element + 1).collect()</code>, just like <em>lambda</em> in python.  </p>
<h3 id="modules">Modules<a class="headerlink" href="#modules" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Like a class without attribute members?  </li>
<li>No... It is same as <code>#include</code> while class methods are defined by <code>impl</code>.  </li>
</ul>
<p>For the general cases:  </p>
<table>
<thead>
<tr>
<th>概念</th>
<th>C++ 对应</th>
<th>Rust 对应</th>
</tr>
</thead>
<tbody>
<tr>
<td>类型定义</td>
<td><code>struct</code>, <code>class</code></td>
<td><code>struct</code>, <code>enum</code></td>
</tr>
<tr>
<td>方法</td>
<td>成员函数</td>
<td><code>impl</code> 块中的方法</td>
</tr>
<tr>
<td>接口/抽象</td>
<td>抽象类, 虚函数</td>
<td><code>trait</code> + <code>impl</code></td>
</tr>
<tr>
<td>模块/命名空间</td>
<td><code>namespace</code>, <code>.h</code> 文件</td>
<td><code>mod</code>, <code>use</code>, <code>crate</code></td>
</tr>
<tr>
<td>宏</td>
<td><code>#define</code>, <code>template</code></td>
<td><code>macro_rules!</code>, <code>macro</code></td>
</tr>
<tr>
<td>可选值</td>
<td>指针或 <code>std::optional</code></td>
<td><code>Option&lt;T&gt;</code></td>
</tr>
<tr>
<td>错误处理</td>
<td>异常 (<code>try/catch</code>)</td>
<td><code>Result&lt;T, E&gt;</code></td>
</tr>
<tr>
<td>内存管理</td>
<td>手动或智能指针</td>
<td>所有权系统 + 生命周期</td>
</tr>
</tbody>
</table>
<h2 id="day-02-rustlings-11-13">Day 02 - rustlings 11-13<a class="headerlink" href="#day-02-rustlings-11-13" title="Permanent link">&para;</a></h2>
<h3 id="hashmaps">Hashmaps<a class="headerlink" href="#hashmaps" title="Permanent link">&para;</a></h3>
<ol>
<li><code>use</code>  </li>
<li>Create: <code>let mut map = HashMap::new();</code>   </li>
<li>Insert:   <ol>
<li>Must exist: <code>map.insert(key, value)</code>   </li>
<li>Not sure: <code>map.entry(key).or_insert(value)</code>  </li>
</ol>
</li>
<li>Get: <code>map.get(key)</code> -&gt; <code>Some(value)</code>  </li>
<li>Loop:  <ol>
<li>Readonly: <code>for (key, value) in &amp;map {}</code>  </li>
<li>Mutable: <code>for (key, value) in &amp;mut map {}</code>   </li>
<li>for <em>keys</em> / <em>values</em> only: <code>for key in map.keys()</code>, <code>for value in map.values()</code>  </li>
<li><code>map.iter()</code>  </li>
<li>Consumable iteration (move the ownership, i.e. cannot be used next time): <code>map.into_iter()</code>  </li>
</ol>
</li>
<li>Update:  <ol>
<li>Must exist: <code>map.insert(key, value)</code>   </li>
<li>Not sure: <code>map.and_modify(key, value)</code>   </li>
</ol>
</li>
<li>Remove: <code>map.remove(key, value)</code>  </li>
</ol>
<p><code>hashmaps2.rs</code> 似乎有问题，47加一个<code>use</code>可以解决<br />
<div class="highlight"><pre><span></span><code><span class="mi">44</span><span class="w">     </span><span class="cp">#[cfg(test)]</span>
<span class="mi">45</span><span class="w">     </span><span class="k">mod</span><span class="w"> </span><span class="nn">tests</span><span class="w"> </span><span class="p">{</span>
<span class="mi">46</span><span class="w">         </span><span class="k">use</span><span class="w"> </span><span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
<span class="mi">47</span><span class="w"> </span><span class="o">+++</span><span class="w">     </span><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">iter</span><span class="p">::</span><span class="n">FromIterator</span><span class="p">;</span>
</code></pre></div></p>
<p><code>hashmaps3.rs</code> is quite interesting  </p>
<p>Here is my implementation, which is obviously stupid...  <br />
<div class="highlight"><pre><span></span><code><span class="n">scores</span><span class="p">.</span><span class="n">entry</span><span class="p">(</span><span class="n">team_1_name</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">and_modify</span><span class="p">(</span><span class="o">|</span><span class="n">v</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="n">v</span><span class="p">.</span><span class="n">goals_scored</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">team_1_score</span><span class="p">;</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">goals_conceded</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">team_2_score</span><span class="p">})</span>
<span class="w">    </span><span class="p">.</span><span class="n">or_insert</span><span class="p">(</span><span class="n">TeamScores</span><span class="p">{</span><span class="n">goals_scored</span><span class="p">:</span><span class="w"> </span><span class="nc">team_1_score</span><span class="p">,</span><span class="w"> </span><span class="n">goals_conceded</span><span class="p">:</span><span class="w"> </span><span class="nc">team_2_score</span><span class="p">});</span>
<span class="n">scores</span><span class="p">.</span><span class="n">entry</span><span class="p">(</span><span class="n">team_2_name</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">and_modify</span><span class="p">(</span><span class="o">|</span><span class="n">v</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="n">v</span><span class="p">.</span><span class="n">goals_scored</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">team_2_score</span><span class="p">;</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">goals_conceded</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">team_1_score</span><span class="p">})</span>
<span class="w">    </span><span class="p">.</span><span class="n">or_insert</span><span class="p">(</span><span class="n">TeamScores</span><span class="p">{</span><span class="n">goals_scored</span><span class="p">:</span><span class="w"> </span><span class="nc">team_2_score</span><span class="p">,</span><span class="w"> </span><span class="n">goals_conceded</span><span class="p">:</span><span class="w"> </span><span class="nc">team_1_score</span><span class="p">});</span>
</code></pre></div></p>
<p>The solution is quite interesting:<br />
<div class="highlight"><pre><span></span><code><span class="c1">// Insert the default with zeros if a team doesn&#39;t exist yet.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">team_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scores</span><span class="p">.</span><span class="n">entry</span><span class="p">(</span><span class="n">team_1_name</span><span class="p">).</span><span class="n">or_default</span><span class="p">();</span>
<span class="c1">// Update the values.</span>
<span class="n">team_1</span><span class="p">.</span><span class="n">goals_scored</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">team_1_score</span><span class="p">;</span>
<span class="n">team_1</span><span class="p">.</span><span class="n">goals_conceded</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">team_2_score</span><span class="p">;</span>

<span class="c1">// Similarly for the second team.</span>
<span class="kd">let</span><span class="w"> </span><span class="n">team_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scores</span><span class="p">.</span><span class="n">entry</span><span class="p">(</span><span class="n">team_2_name</span><span class="p">).</span><span class="n">or_default</span><span class="p">();</span>
<span class="n">team_2</span><span class="p">.</span><span class="n">goals_scored</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">team_2_score</span><span class="p">;</span>
<span class="n">team_2</span><span class="p">.</span><span class="n">goals_conceded</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">team_1_score</span><span class="p">;</span>
</code></pre></div></p>
<ol>
<li><code>or_default()</code> will insert a default value into hash maps when there is no such entry. The default values of some types are:      <ul>
<li>
<table>
<thead>
<tr>
<th>类型</th>
<th><code>Default::default()</code> 的值</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>u8</code></td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>bool</code></td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>String</code></td>
<td><code>""</code></td>
</tr>
<tr>
<td><code>Vec&lt;T&gt;</code></td>
<td><code>[]</code></td>
</tr>
<tr>
<td><code>Option&lt;T&gt;</code></td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</li>
</ul>
</li>
<li><code>or_default</code> -&gt; <code>mut &amp;</code>, i.e. it will return a mutable reference, so changing team_1 is changing the bucket.  </li>
</ol>
<h3 id="options">Options<a class="headerlink" href="#options" title="Permanent link">&para;</a></h3>
<p>Just <code>Some(...)</code> and <code>None</code>  </p>
<p>However, the usage of <code>match</code> is appalled: <strong><code>match</code> will move the ownership when matching!</strong>  </p>
<h3 id="error-handling-results">Error Handling (Results)<a class="headerlink" href="#error-handling-results" title="Permanent link">&para;</a></h3>
<p>1-3 and 5 are basic questions.</p>
<h4 id="errors4rs"><code>errors4.rs</code><a class="headerlink" href="#errors4rs" title="Permanent link">&para;</a></h4>
<p>Understanding:<br />
1. <code>#[derive(...)]</code> is a <code>macro</code>, using it can add common <em>traits</em> to <strong>structs</strong> and <strong>enums</strong>.<br />
2. <code>#[derive(PartialEq, Debug)]</code> add <em>traits</em> <code>PartialEq</code> and <code>Debug</code> to the <em>struct</em> <code>PositiveNonzeroInteger</code>, so that:<br />
    1. <code>PartialEq</code> <del>can deal with equality test without changing types of both sides to be exactly same.</del> <strong>This is wrong! The types of sides of equality test must be the same. However, it is the trait that enables the equality test to make sense. Without it, there is no defination in the struct and its implementation for <mark>, !</mark>.</strong> <br />
        -  For example, assert_eq!(PositiveNonzeroInteger::new(10), Ok(PositiveNonzeroInteger(10)));  will not yield an error, <del>although the left is a struct and the right is the struct wrapped into an result.</del> <strong>They are in the same types. The new <em>impl</em> returns an result as well!  Remember, both sides must be in the same type.</strong> However, without PartialEq, the == cannot be recognised.<br />
        -  Comparing PositiveNonzeroInteger::new(10) &gt;= PositiveNonzeroInteger::new(8) is not applicable here, as PartialEq only deal with equality test, while the comparisons are handled by the <em>trait*s PartialOrd (<del>may fail and return None</del> Best effort. If not compariable, return None. e.g. comparing any float number with <code>NaN</code>) or Ord (must use with PartialEq and PartialOrd. <del>Will never fail but may be over-compared</del> Will always give a boolean result or the program will crash. <del>e.g. we may not need a real comparison for a float number and a string</del> We cannot compare a float with a string, the both sides must be in the same type. e.g. comparing any float number with <code>NaN</code> in <code>Ord</code> will crash the program as there is not such trait applied, which is because this camparison is logically nonsense). <br />
    2. <code>Debug</code> enables <code>{:?}</code> and <code>{:#?}</code> in <code>println!</code><br />
3. <code>Self</code> means the *impl</em> <code>PositiveNonzeroInteger</code>. (Nothing special here, just like <code>self</code> in python.)  </p>
<p>For implementation, <code>if value &gt;/==</code> is trivial:<br />
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// value is i64 and we need u64 inside the struct</span>
<span class="w">    </span><span class="c1">// use `as` to cast the type</span>
<span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="n">PositiveNonzeroInteger</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u64</span><span class="p">))</span><span class="w"> </span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">Err</span><span class="p">(</span><span class="n">CreationError</span><span class="p">::</span><span class="n">Zero</span><span class="p">)</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">Err</span><span class="p">(</span><span class="n">CreationError</span><span class="p">::</span><span class="n">Negative</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
Although complicated, there is no issue. <code>match</code> is useful as well, the comparison can be handled in braches:<br />
<div class="highlight"><pre><span></span><code><span class="k">match</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">n</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">PositiveNonzeroInteger</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u64</span><span class="p">)),</span><span class="w"> </span><span class="c1">// handle the postive part</span>
<span class="w">    </span><span class="mi">0</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">CreationError</span><span class="p">::</span><span class="n">Zero</span><span class="p">),</span>
<span class="w">    </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">CreationError</span><span class="p">::</span><span class="n">Negative</span><span class="p">),</span>
<span class="p">}</span>
</code></pre></div>
However, there is a fancy and idiomatic (<strong>地道的</strong>, 习语的, 成语的, 合乎语言习惯的) method, given in the sample solution:<br />
<div class="highlight"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">cmp</span><span class="p">::</span><span class="n">Ordering</span><span class="p">;</span>
<span class="k">match</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="n">cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Ordering</span><span class="p">::</span><span class="n">Less</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">CreationError</span><span class="p">::</span><span class="n">Negative</span><span class="p">),</span>
<span class="w">    </span><span class="n">Ordering</span><span class="p">::</span><span class="n">Equal</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">CreationError</span><span class="p">::</span><span class="n">Zero</span><span class="p">),</span>
<span class="w">    </span><span class="n">Ordering</span><span class="p">::</span><span class="n">Greater</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="bp">Self</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u64</span><span class="p">)),</span>
<span class="p">}</span>
</code></pre></div>
<a href="https://doc.rust-lang.org/std/cmp/trait.Ord.html#tymethod.cmp"><code>impl Ord</code> for <code>i64</code> gives <code>fn cmp</code></a>, the return value is of type <a href="https://doc.rust-lang.org/std/cmp/enum.Ordering.html"><code>Ording</code></a>, which is a <em>enum</em> with only 3 values:<br />
<div class="highlight"><pre><span></span><code><span class="cp">#[repr(i8)]</span>
<span class="k">pub</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="nc">Ordering</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Less</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">Equal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">Greater</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></p>
<h4 id="errors6rs"><code>errors6.rs</code><a class="headerlink" href="#errors6rs" title="Permanent link">&para;</a></h4>
<h5 id="now-how-can-we-handle-errors">Now how can we handle errors?<a class="headerlink" href="#now-how-can-we-handle-errors" title="Permanent link">&para;</a></h5>
<ol>
<li>We <em>can</em> (obviously we do not want) let it crash, by compiler errors, or <code>panic</code> (just like <code>assert</code> in python)  </li>
<li>Just like <code>try</code> and <code>except</code> in python, we can handle the known issue we might have and let the program continues. We use <code>Result&lt;T, E&gt;</code> syntax in rust with reasons in <code>E</code>, like <code>TypeError</code> in python.  <ol>
<li>For catch-all. Sometimes we do not care about why, just like <code>except</code> without specific error in python. we can use <code>Box&lt;dyn Error&gt;</code> in <code>errors5.rs</code> or just self-buit message like <code>Err(format!("Empty names aren't allowed"))</code> in <code>errors1.rs</code>. However, these are not standarised for re-use.  </li>
<li>Preferably, we define the error types in <code>enum</code> (now like C) and then map the error for readability.  </li>
</ol>
</li>
</ol>
<p>Here, we first create the <em>enum</em> if error types</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">num</span><span class="p">::</span><span class="n">ParseIntError</span><span class="p">;</span>

<span class="cp">#[derive(PartialEq, Debug)]</span>
<span class="k">enum</span><span class="w"> </span><span class="nc">CreationError</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Negative</span><span class="p">,</span>
<span class="w">    </span><span class="n">Zero</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
<p>Then, we need an <em>impl</em> to parse the error - just like in python, to give definition of the process that <code>5 + "1"</code> will raise <code>TypeError</code>. But *impl*s cannot exist themself, we need a enum to place them:  </p>
<div class="highlight"><pre><span></span><code><span class="cp">#[derive(PartialEq, Debug)]</span>
<span class="k">enum</span><span class="w"> </span><span class="nc">ParsePosNonzeroError</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Creation</span><span class="p">(</span><span class="n">CreationError</span><span class="p">),</span>
<span class="w">    </span><span class="n">ParseInt</span><span class="p">(</span><span class="n">ParseIntError</span><span class="p">),</span>
<span class="p">}</span>

<span class="k">impl</span><span class="w"> </span><span class="n">ParsePosNonzeroError</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">from_creation</span><span class="p">(</span><span class="n">err</span><span class="p">:</span><span class="w"> </span><span class="nc">CreationError</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="bp">Self</span><span class="p">::</span><span class="n">Creation</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// TODO: Add another error conversion function here.</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">from_parse_int</span><span class="p">(</span><span class="n">err</span><span class="p">:</span><span class="w"> </span><span class="nc">ParseIntError</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="bp">Self</span><span class="p">::</span><span class="n">ParseInt</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The <em>enum</em> <code>ParsePosNonzeroError</code> gives almost nothing, just wrap the enum <code>CreationError</code> and <code>ParseIntError</code> (using from std) again. However, with their helps, we can now give <em>impl</em> to translate them. Note that there is noway to give one <em>enum</em> only, as the <code>CreationError</code> and <code>ParseIntError</code> are handlers where <code>ParsePosNonzeroError</code> is the process. </p>
<p>The <em>impl</em> will take the handler in as an argument and then return an error of its *variant*s.</p>
<h5 id="creationerror-internal"><code>CreationError</code> internal<a class="headerlink" href="#creationerror-internal" title="Permanent link">&para;</a></h5>
<p>Lets see the process of 
<div class="highlight"><pre><span></span><code><span class="cp">#[test]</span>
<span class="k">fn</span><span class="w"> </span><span class="nf">test_zero</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span>
<span class="w">        </span><span class="n">PositiveNonzeroInteger</span><span class="p">::</span><span class="n">parse</span><span class="p">(</span><span class="s">&quot;0&quot;</span><span class="p">),</span>
<span class="w">        </span><span class="nb">Err</span><span class="p">(</span><span class="n">ParsePosNonzeroError</span><span class="p">::</span><span class="n">Creation</span><span class="p">(</span><span class="n">CreationError</span><span class="p">::</span><span class="n">Zero</span><span class="p">)),</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></p>
<p>The <code>"0"</code> is parsed by <code>PositiveNonzeroInteger::parse()</code></p>
<div class="highlight"><pre><span></span><code><span class="k">impl</span><span class="w"> </span><span class="n">PositiveNonzeroInteger</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">new</span><span class="p">(</span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="kt">i64</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="bp">Self</span><span class="p">,</span><span class="w"> </span><span class="n">CreationError</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">x</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">CreationError</span><span class="p">::</span><span class="n">Negative</span><span class="p">),</span>
<span class="w">            </span><span class="mi">0</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">CreationError</span><span class="p">::</span><span class="n">Zero</span><span class="p">),</span>
<span class="w">            </span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="bp">Self</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u64</span><span class="p">)),</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">parse</span><span class="p">(</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="bp">Self</span><span class="p">,</span><span class="w"> </span><span class="n">ParsePosNonzeroError</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// TODO: change this to return an appropriate error instead of panicking</span>
<span class="w">        </span><span class="c1">// when `parse()` returns an error.</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">parse</span><span class="p">().</span><span class="n">unwrap</span><span class="p">()</span><span class="o">..</span><span class="p">.;</span>
<span class="w">        </span><span class="bp">Self</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">x</span><span class="p">).</span><span class="n">map_err</span><span class="p">(</span><span class="n">ParsePosNonzeroError</span><span class="p">::</span><span class="n">from_creation</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>First, the <code>fn parse</code> deal with <code>"0".parse()</code>. <code>str.parse()</code> is <a href="https://doc.rust-lang.org/std/primitive.str.html#method.parse">to parse any <code>&amp;str</code> into another type, wrapped by <code>Result &lt;T,E&gt;</code></a>, which is so general, so the type must be known for compiler. For example  </p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;0&quot;</span><span class="p">.</span><span class="n">parse</span><span class="p">();</span><span class="w"> </span><span class="c1">// Error, the compiler does not know the type of x</span>
<span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;0&quot;</span><span class="p">.</span><span class="n">parse</span><span class="p">();</span><span class="w"> </span><span class="c1">// Error, the return value of `parse()` is wrapped in `Result &lt;T, E&gt;` </span>
<span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">num</span><span class="p">::</span><span class="n">ParseIntError</span><span class="p">;</span>
<span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="nb">Result</span><span class="o">&lt;</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">ParseIntError</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;0&quot;</span><span class="p">.</span><span class="n">parse</span><span class="p">();</span><span class="w"> </span><span class="c1">// Works, but rare. x = Ok(0)</span>

<span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;0&quot;</span><span class="p">.</span><span class="n">parse</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span><span class="w"> </span><span class="c1">// Good, the compiler infer &quot;0&quot;.parse() to be i32</span>
<span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;0&quot;</span><span class="p">.</span><span class="n">parse</span><span class="p">::</span><span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span><span class="w"> </span><span class="c1">// Good, the compiler infer x to be i32, as the type of &quot;0&quot;.parse() is specified by generic syntax</span>
</code></pre></div>
<p>So now, we ignore the error handling <code>...</code> after <code>s.parse().unwrap()</code> and get <code>x:i64=0</code>. We now pass the <code>x</code> to <code>Self::new(x)</code>, which is <code>PositiveNonzeroInteger:new(x)</code>. The <code>new()</code> does <code>match</code> and find return <code>Err(CreationError::Zero)</code>. Now, we handle the error: <code>Err(CreationError::Zero).map_err(ParsePosNonzeroError::from_creation)</code>. From the basics, the <code>map_err</code> just map all errors (here is <code>Err(CreationError::Zero)</code>) to a specific error <code>Err&lt;e&gt;</code>, where e is returned by a process (here is <code>ParsePosNonzeroError::from_creation</code>). The process <code>ParsePosNonzeroError::from_creation</code> is a <code>impl fn</code>, which is just like function pointer in C. The process <code>ParsePosNonzeroError::from_creation</code> get <code>CreationError::Zero</code> as an argument and find the type is correct (as the parameter is defined as <code>err: CreationError</code>). Now, it will give the return value as <code>e = ParsePosNonzeroError::Creation(CreationError::Zero)</code>. The <code>map_err()</code> will wrap the <code>e</code> into an <code>Err&lt;&gt;</code>, therefore, the final result is <code>Err(ParsePosNonzeroError::Creation(CreationError::Zero))</code>, which is correct!  </p>
<h5 id="fix-to-do">Fix <code>to do</code><a class="headerlink" href="#fix-to-do" title="Permanent link">&para;</a></h5>
<p>Now, we need to think about what we ignore. If <code>&amp;str.parse()</code> fails, the program will crash when <code>unwrap()</code>. To deal with this, we can match the result:  </p>
<div class="highlight"><pre><span></span><code><span class="c1">// this is how we init Result&lt;T,E&gt; var</span>
<span class="kd">let</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">parse</span><span class="p">::</span><span class="o">&lt;</span><span class="kt">i64</span><span class="o">&gt;</span><span class="p">();</span>
<span class="k">match</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="bp">Self</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">v</span><span class="p">).</span><span class="n">map_err</span><span class="p">(</span><span class="n">ParsePosNonzeroError</span><span class="p">::</span><span class="n">from_creation</span><span class="p">),</span>
<span class="w">    </span><span class="nb">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">e</span><span class="p">).</span><span class="n">map_err</span><span class="p">(</span><span class="n">ParsePosNonzeroError</span><span class="p">::</span><span class="n">from_parse_int</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>However, a better way is:</p>
<div class="highlight"><pre><span></span><code><span class="k">fn</span><span class="w"> </span><span class="nf">parse</span><span class="p">(</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="bp">Self</span><span class="p">,</span><span class="w"> </span><span class="n">ParsePosNonzeroError</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Return an appropriate error instead of panicking when `parse()`</span>
<span class="w">    </span><span class="c1">// returns an error.</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">parse</span><span class="p">().</span><span class="n">map_err</span><span class="p">(</span><span class="n">ParsePosNonzeroError</span><span class="p">::</span><span class="n">from_parse_int</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="bp">Self</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">x</span><span class="p">).</span><span class="n">map_err</span><span class="p">(</span><span class="n">ParsePosNonzeroError</span><span class="p">::</span><span class="n">from_creation</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>If <code>s.parse()</code> is successful, then value inside <code>Ok()</code> is extracted and assigned to <code>x</code>; Otherwise, it raises <code>Err(ParseIntError)</code>. Then  <code>Err(ParseIntError)</code> will be mapped by the process of <code>ParsePosNonzeroError::from_parse_int</code>, from <code>Err(ParseIntError)</code> to <code>Err(Self::ParseInt(err))</code>. Therefore, the final result of this line should be either <br />
    - <code>x</code> is assigned to some <code>i64</code> and then use <code>new()</code> to find the creation error,<br />
    - or return <code>Err(ParsePosNonzeroError::ParseInt(ParseIntError))</code>.   </p>
<h5 id="a-standarised-way-from-trait">A Standarised Way - <code>From</code> <em>Trait</em><a class="headerlink" href="#a-standarised-way-from-trait" title="Permanent link">&para;</a></h5>
<p>This is actually a manual built <code>From</code> <em>trait</em>. A better way is:  </p>
<div class="highlight"><pre><span></span><code><span class="cp">#[derive(PartialEq, Debug)]</span>
<span class="k">enum</span><span class="w"> </span><span class="nc">ParsePosNonzeroError</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Creation</span><span class="p">(</span><span class="n">CreationError</span><span class="p">),</span>
<span class="w">    </span><span class="n">ParseInt</span><span class="p">(</span><span class="n">ParseIntError</span><span class="p">),</span>
<span class="p">}</span>

<span class="c1">// 标准化的 From 实现</span>
<span class="k">impl</span><span class="w"> </span><span class="nb">From</span><span class="o">&lt;</span><span class="n">CreationError</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">ParsePosNonzeroError</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">from</span><span class="p">(</span><span class="n">err</span><span class="p">:</span><span class="w"> </span><span class="nc">CreationError</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ParsePosNonzeroError</span><span class="p">::</span><span class="n">Creation</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">impl</span><span class="w"> </span><span class="nb">From</span><span class="o">&lt;</span><span class="n">ParseIntError</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">ParsePosNonzeroError</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">from</span><span class="p">(</span><span class="n">err</span><span class="p">:</span><span class="w"> </span><span class="nc">ParseIntError</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ParsePosNonzeroError</span><span class="p">::</span><span class="n">ParseInt</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Now, the creation error is handled in a standarised way. We can now simplify the <code>fn parse()</code>:  </p>
<div class="highlight"><pre><span></span><code><span class="k">fn</span><span class="w"> </span><span class="nf">parse</span><span class="p">(</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="bp">Self</span><span class="p">,</span><span class="w"> </span><span class="n">ParsePosNonzeroError</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="kt">i64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">parse</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// the mapping is handled via `From` automatically</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">Self</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// the mapping is handled via `From` automatically</span>
<span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="c1">// The v is now unwrapped if successful. To make return value in the same type, wrap it again.</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="map_err-internal"><code>map_err</code> Internal<a class="headerlink" href="#map_err-internal" title="Permanent link">&para;</a></h5>
<p>What is <code>map_err</code>? What are the parameters?</p>
<blockquote>
<p><code>pub fn map_err&lt;F, O&gt;(self, op: O) -&gt; Result&lt;T, F&gt;</code><br />
where <code>O: FnOnce(E) -&gt; F,</code>   </p>
<p>Maps a Result<T, E> to Result<T, F> by applying a function to a contained Err value, leaving an Ok value untouched.  </p>
<p>This function can be used to pass through a successful result while handling an error.</p>
<p>Examples  </p>
<div class="highlight"><pre><span></span><code><span class="k">fn</span><span class="w"> </span><span class="nf">stringify</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="kt">u32</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;error code: {x}&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w">  </span>

<span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="kt">u32</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w">  </span>
<span class="fm">assert_eq!</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">map_err</span><span class="p">(</span><span class="n">stringify</span><span class="p">),</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span><span class="w">  </span>

<span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="kt">u32</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="mi">13</span><span class="p">);</span><span class="w">  </span>
<span class="fm">assert_eq!</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">map_err</span><span class="p">(</span><span class="n">stringify</span><span class="p">),</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="s">&quot;error code: 13&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">()));</span><span class="w">  </span>
</code></pre></div>
</blockquote>
<p>Given <code>a:&lt;Result&lt;T,E&gt;&gt;</code> <code>a.map_err(Op)</code> is equivlent to a <code>match</code> statement:   </p>
<div class="highlight"><pre><span></span><code><span class="k">match</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">v</span><span class="p">),</span><span class="w"> </span><span class="c1">// leave the T part not touched</span>
<span class="w">    </span><span class="nb">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">Op</span><span class="p">(</span><span class="n">e</span><span class="p">)),</span>
<span class="p">};</span>
</code></pre></div>
<p>where <code>Op: FnOnce</code> is a one-time (means the ownership will be moved after the first call -  we do not want to an error twice) function pointer or closure pointer. <code>Op(e)</code> will return another <code>e</code>, which is why it is called <code>map_err()</code>.  </p>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="August 6, 2025 01:41:54 UTC">August 6, 2025</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="August 5, 2025 04:05:37 UTC">August 5, 2025</span>
  </span>

    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>